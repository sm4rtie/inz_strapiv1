<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Inbox</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.css"/>
    <link rel="stylesheet" type="text/css" href="../styles/inbox.css"/>

    <!-- Bootstrap core CSS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.17.0/dist/jquery.validate.min.js"></script>
<style>
.bold {
  font-weight:bold;
}
</style>
  </head>
<body>
<div>
<%- include('../partials/navbar') %>
</div>
<script>
$(document).ready(function () {
  str = window.location.pathname;
  var n = str.lastIndexOf('/');
  var result = str.substring(n+1);
  console.log(result);
  $.ajax({
    type: 'GET', // define the type of HTTP verb we want to use (POST for our form)
    url: '/contact/' + result, // the url where we want to POST
        headers: {
          'Authorization': 'Bearer '+ JSON.parse(sessionStorage.getItem("jwtToken"))
        },
    success: function(data) { //any name you put in as an argument here will be the json response string.
    if(data.read==="false"){
      $.ajax({
        type: 'PUT', // define the type of HTTP verb we want to use (POST for our form)
        url: '/contact/' + result, // the url where we want to POST
            headers: {
              'Authorization': 'Bearer '+ JSON.parse(sessionStorage.getItem("jwtToken"))
            },
        data: {
          read: 'true',
        }, // our data object

      success: function(data) { //any name you put in as an argument here will be the json response string.
        console.log(data);
    },
    error: function (error) {
     // alert('nay');
      console.log(error);
      //window.location = "/edituser";
    }
  });
    }
},
error: function (error) {
 // alert('nay');
  console.log(error);
  //window.location = "/edituser";
}
});
/*
    $.ajax({
      type: 'PUT', // define the type of HTTP verb we want to use (POST for our form)
      url: '/contact/' + result, // the url where we want to POST
          headers: {
            'Authorization': 'Bearer '+ JSON.parse(sessionStorage.getItem("jwtToken"))
          },
      data: {
        read: 'true',
      }, // our data object

    success: function(data) { //any name you put in as an argument here will be the json response string.
      console.log(data);
  },
  error: function (error) {
   // alert('nay');
    console.log(error);
    //window.location = "/edituser";
  }
});*/
});
</script>
<p></p>
<div class="container">
    <div class="center-block">
        <div class="col-xs-4 col-xs-offset-8 center">
          <ul class="chat">
            <div class="bg-info">
              <li class="left clearfix">
                <div class="chat-body clearfix">
                  <div class="header">
                    <h4><strong class="primary-font"> Ticket: </strong></h4>
                    <strong class="primary-font"> From:</strong>
                    <small class="pull-right text-muted"> #{mail.createdAt}
                      <span class="glyphicon glyphicon-time">
                      </small>
                      </div>
                  <p> #{mail.message.md}</p>
                </div>
                </li>
                </div>
                </ul>
            if(previous)
              each prev in previous
                li(class="left clearfix")
                  span(class="glyphicon glyphicon-user")
                  div(class="chat-body clearfix")
                    div(class="header")
                      strong(class="primary-font") #{prev.from}
                      small(class="pull-right text-muted") #{prev.createdAt}
                        span(class="glyphicon glyphicon-time")
                    p #{prev.message.md}
                  if(prev.response)
                    li(class="left clearfix")
                      span(class="glyphicon glyphicon-envelope")
                      div(class="chat-body clearfix")
                        div(class="header")
                          strong(class="primary-font") Me
                          small(class="pull-right text-muted") #{prev.responseAt}
                            span(class="glyphicon glyphicon-time")
                        p #{prev.response}
          hr
          div
            .row: .col-sm-8.col-md-6
              form(method='post' id='formularz')
                input(type='hidden', name='action', value='reply')
                .form-group
                  //(class=validationErrors.message ? 'has-error' : null)
                  label Reply
                  textarea(name='response' rows=4).form-control= formData.response
                .form-actions
                  button(type='submit').btn.btn-primary Send

</div>
</div>
</div>
</body>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.16/af-2.2.2/b-1.5.1/b-colvis-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/cr-1.4.1/fc-3.2.4/fh-3.1.3/kt-2.3.2/r-2.2.1/rg-1.0.2/rr-1.2.3/sc-1.4.4/sl-1.2.5/datatables.min.js"></script>

</html>
